<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Souza Farma - Bulas Digitais</title>
    <!-- Carrega o Tailwind CSS para estiliza√ß√£o r√°pida -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .close-button {
            transition: all 0.2s;
        }
        .close-button:hover {
            transform: rotate(90deg);
            color: #ef4444;
        }
        .logo-container {
            max-width: 300px;
            margin: 0 auto;
            padding: 10px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .intensity-btn.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4338ca;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.4);
        }
        .freq-highlight {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
        }
    </style>

    <script>
        window.allMedicamentos = []; 
        const LOCAL_STORAGE_KEY = 'souzafarma_bulas_local';

        const mockMedicamentos = [
            { 
                nome: "Decongex Plus Gotas", 
                principioAtivo: "Bronfeniramina + Fenilefrina", 
                dosagem: "2 mg/mL + 2,5 mg/mL", 
                indicacoes: "Al√≠vio de coriza, congest√£o nasal e sintomas gripais.", 
                reacoesAdversas: "Sonol√™ncia, boca seca, tontura.", 
                viaAdministracao: "Oral", 
                categoria: "Descongestionante e Anti-histam√≠nico",
                tipoCalculo: "tabelaDecongexGotas",
                pesoBaseCalculo: { 
                    maxDoseDiariaGotas: 60,
                    restricaoIdade: "Contraindicado para crian√ßas menores de 2 anos.",
                    freqTexto: "Administrar 3 vezes ao dia (a cada 8 horas)." 
                }
            },
            { 
                nome: "Decongex Plus Xarope", 
                principioAtivo: "Bronfeniramina + Fenilefrina", 
                dosagem: "2mg + 5mg / 5mL", 
                indicacoes: "Al√≠vio de coriza, congest√£o nasal e sintomas gripais.", 
                categoria: "Descongestionante e Anti-histam√≠nico",
                tipoCalculo: "tabelaDecongex",
                pesoBaseCalculo: { 
                    maxDoseDiariaMl: 60,
                    restricaoIdade: "Contraindicado para crian√ßas menores de 2 anos.",
                    freqTexto: "Administrar 3 a 4 vezes ao dia conforme a idade." 
                }
            },
            { 
                nome: "Predsim¬Æ Solu√ß√£o 3 mg/mL", 
                principioAtivo: "Fosfato S√≥dico de Prednisolona", 
                dosagem: "3 mg/mL (Uso com Pipeta)", 
                indicacoes: "Agente anti-inflamat√≥rio e imunossupressor.", 
                viaAdministracao: "Oral", 
                categoria: "Corticosteroide",
                tipoCalculo: "intensidade",
                pesoBaseCalculo: { 
                    temIntensidade: true,
                    intensidades: [
                        { label: "Manuten√ß√£o (0.5 mg/kg)", valor: 0.5, obs: "(Dose padr√£o)" },
                        { label: "Intermedi√°ria (1.0 mg/kg)", valor: 1.0, obs: "(Crises moderadas)" },
                        { label: "Ataque (2.0 mg/kg)", valor: 2.0, obs: "(Crises graves)" }
                    ],
                    currentIntensidade: 0.5,
                    freqDosesPorDia: 1, 
                    concentracaoMgPerMl: 3,
                    unidade: "mL",
                    maxDoseDiariaMg: 60,
                    restricaoIdade: "Utilizar a pipeta exclusiva que acompanha o produto.",
                    freqTexto: "Total di√°rio para ser administrado de 3 a 4 vezes ao dia." 
                }
            },
            { 
                nome: "Fosfato S√≥dico de Prednisolona Solu√ß√£o 3 mg/mL", 
                principioAtivo: "Fosfato S√≥dico de Prednisolona", 
                dosagem: "3 mg/mL (Gen√©rico)", 
                categoria: "Corticosteroide",
                tipoCalculo: "intensidade",
                pesoBaseCalculo: { 
                    temIntensidade: true,
                    intensidades: [
                        { label: "Manuten√ß√£o (0.5 mg/kg)", valor: 0.5, obs: "(Dose padr√£o)" },
                        { label: "Intermedi√°ria (1.0 mg/kg)", valor: 1.0, obs: "(Crises moderadas)" },
                        { label: "Ataque (2.0 mg/kg)", valor: 2.0, obs: "(Crises graves)" }
                    ],
                    currentIntensidade: 0.5,
                    freqDosesPorDia: 1, 
                    concentracaoMgPerMl: 3,
                    unidade: "mL",
                    maxDoseDiariaMg: 60,
                    restricaoIdade: "Utilizar a pipeta graduada.",
                    freqTexto: "Total di√°rio para ser administrado de 3 a 4 vezes ao dia." 
                }
            },
            { 
                nome: "Predsim Gotas", 
                principioAtivo: "Fosfato S√≥dico de Prednisolona", 
                dosagem: "11 mg/mL (1 gota ‚âà 0,55 mg)", 
                categoria: "Corticosteroide",
                tipoCalculo: "intensidade",
                pesoBaseCalculo: { 
                    temIntensidade: true,
                    intensidades: [
                        { label: "Manuten√ß√£o (0.5 mg/kg)", valor: 0.5, obs: "(Dose padr√£o)" },
                        { label: "Intermedi√°ria (1.0 mg/kg)", valor: 1.0, obs: "(Crises moderadas)" },
                        { label: "Ataque (2.0 mg/kg)", valor: 2.0, obs: "(Crises graves)" }
                    ],
                    currentIntensidade: 0.5,
                    freqDosesPorDia: 1, 
                    concentracaoMgPerMl: 11,
                    unidade: "Gotas",
                    maxDosePorTomada: 145, 
                    maxDoseDiaria: 145,
                    restricaoIdade: "Dose m√°xima recomendada: 80 mg/dia.",
                    freqTexto: "Administrar 1 a 4 vezes ao dia, conforme orienta√ß√£o m√©dica." 
                }
            },
            { 
                nome: "Buscopan¬Æ Composto Gotas", 
                principioAtivo: "Escopolamina + Dipirona", 
                dosagem: "6,67mg + 333,4mg / mL (20 gotas)", 
                categoria: "Antiespasm√≥dico e Analg√©sico",
                tipoCalculo: "tabelaBuscopanComposto",
                pesoBaseCalculo: { 
                    obsBula: "(C√°lculo: 1 gota para cada 2 kg para crian√ßas)",
                    restricaoIdade: "Crian√ßas de 1 a 6 anos: 5 a 10 gotas.",
                    freqTexto: "Frequ√™ncia: 3 a 4 vezes ao dia (a cada 6 ou 8 horas)." 
                }
            },
            { 
                nome: "Buscopan¬Æ Gotas", 
                principioAtivo: "Butilbrometo de Escopolamina", 
                dosagem: "10 mg/mL (1 mL = 20 gotas)", 
                categoria: "Antiespasm√≥dico",
                tipoCalculo: "tabelaBuscopan",
                pesoBaseCalculo: { 
                    obsBula: "(C√°lculo por mg/kg ajustado por idade)",
                    restricaoIdade: "Uso sob prescri√ß√£o m√©dica.",
                    freqTexto: "Geralmente 3 vezes ao dia (a cada 8 horas)." 
                }
            },
            { 
                nome: "Dipirona 500mg/mL Gotas", 
                principioAtivo: "Dipirona Monoidratada", 
                dosagem: "500 mg/mL (1 gota = 25mg)", 
                categoria: "Analg√©sico e Antipir√©tico",
                tipoCalculo: "tabelaDipirona",
                pesoBaseCalculo: { 
                    obsBula: "(Dose baseada na tabela oficial)",
                    maxDoseDiaria: 160,
                    restricaoIdade: "Contraindicado para beb√©s menores de 3 meses.",
                    freqTexto: "Administrar at√© 4 vezes ao dia (a cada 6 horas)." 
                }
            }
        ];

        const initApp = async () => {
            window.allMedicamentos = mockMedicamentos.map((m, index) => ({ id: `mock-${index}`, ...m }));
            searchMedicamentos('');
            document.getElementById('loading-overlay').classList.add('hidden');
        };

        window.searchMedicamentos = (term) => {
            const searchTerm = term.toLowerCase().trim();
            const results = window.allMedicamentos.filter(med => 
                med.nome.toLowerCase().includes(searchTerm) ||
                med.principioAtivo.toLowerCase().includes(searchTerm)
            );
            displayResults(results);
        };

        const displayResults = (results) => {
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = results.length ? '' : `<p class="text-center text-gray-500 py-8">Nenhum resultado.</p>`;
            results.forEach(med => {
                const item = document.createElement('div');
                item.className = 'p-4 bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg transition cursor-pointer flex justify-between items-center';
                item.onclick = () => showBulaDetails(med);
                item.innerHTML = `<div><h3 class="text-lg font-semibold text-gray-800">${med.nome}</h3><p class="text-sm text-gray-500">${med.principioAtivo}</p></div><span class="text-indigo-600 font-medium text-sm">Ver Bula &rarr;</span>`;
                resultsDiv.appendChild(item);
            });
        };

        window.showBulaDetails = (med) => {
            const modal = document.getElementById('bula-modal');
            const content = document.getElementById('bula-content');
            content.innerHTML = `
                <h2 class="text-3xl font-bold text-gray-900 mb-4">${med.nome}</h2>
                <div class="space-y-4">
                    <p><span class="font-semibold text-indigo-600">Princ√≠pio Ativo:</span> ${med.principioAtivo}</p>
                    <p><span class="font-semibold text-indigo-600">Apresenta√ß√£o:</span> ${med.dosagem}</p>
                    <div id="dose-calculator-container"></div>
                    <div class="border-t pt-4">
                        <h3 class="text-xl font-semibold mb-2">Indica√ß√µes</h3>
                        <p>${med.indicacoes}</p>
                    </div>
                </div>
            `;
            if (med.pesoBaseCalculo) setupCalculator(med);
            modal.classList.remove('hidden');
        };

        const setupCalculator = (med) => {
            const container = document.getElementById('dose-calculator-container');
            const p = med.pesoBaseCalculo;
            
            let selectionHtml = "";
            if (p.temIntensidade) {
                selectionHtml = `
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Posologia (mg/kg/dia)</label>
                        <div class="grid grid-cols-1 gap-2">
                            ${p.intensidades.map(int => `
                                <button onclick="changeIntensity('${med.id}', ${int.valor})" 
                                        class="intensity-btn px-4 py-3 text-sm border rounded-xl transition-all font-semibold text-left flex justify-between items-center ${p.currentIntensidade === int.valor ? 'active' : 'bg-white text-gray-600 border-gray-200'}">
                                    <span>${int.label}</span>
                                    <span class="text-xs opacity-70 italic">${int.obs}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="mt-4 bg-indigo-50 p-5 rounded-2xl border border-indigo-100 shadow-inner">
                    <h3 class="text-indigo-800 font-bold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2-2v14a2 2 0 002 2z"></path></svg>
                        Calculadora de Dose
                    </h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Peso da Crian√ßa (kg)</label>
                        <input type="number" id="peso-input" step="0.1" placeholder="Ex: 12" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-lg font-semibold" oninput="runCalculation('${med.id}')">
                    </div>

                    ${selectionHtml}

                    <div id="result-area" class="grid grid-cols-2 gap-3 mb-4">
                        <div id="result-box" class="bg-indigo-600 text-white p-4 rounded-xl text-center shadow-lg transition-all">
                            <p class="text-[10px] uppercase font-bold opacity-80 tracking-wider">Por Tomada</p>
                            <p id="result-dose" class="text-2xl font-bold">---</p>
                        </div>
                        <div class="bg-indigo-900 text-white p-4 rounded-xl text-center shadow-lg transition-all">
                            <p class="text-[10px] uppercase font-bold opacity-80 tracking-wider">Total Di√°rio</p>
                            <p id="result-daily" class="text-2xl font-bold">---</p>
                        </div>
                    </div>

                    <div class="mb-4 freq-highlight p-4 rounded-xl border border-green-200 flex items-start gap-3">
                        <div class="bg-green-500 p-2 rounded-lg text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div>
                            <p class="text-[10px] uppercase font-bold text-green-700 tracking-wider">Frequ√™ncia Sugerida</p>
                            <p id="freq-text-display" class="text-sm font-bold text-green-900 leading-tight">${p.freqTexto}</p>
                        </div>
                    </div>

                    <div id="warning-area" class="space-y-2">
                        <div class="text-[11px] text-gray-500 bg-white p-3 rounded-lg border border-indigo-100">
                            <p id="age-hint" class="font-bold text-indigo-700 mb-1"></p>
                            <p class="mt-1 font-medium text-red-600 flex items-center gap-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                                ${p.restricaoIdade}
                            </p>
                        </div>
                    </div>
                </div>
            `;
            runCalculation(med.id);
        };

        window.runCalculation = (medId) => {
            const med = window.allMedicamentos.find(m => m.id === medId);
            const pesoInput = document.getElementById('peso-input');
            const peso = parseFloat(pesoInput.value);
            window.lastWeight = pesoInput.value;
            const p = med.pesoBaseCalculo;
            
            const doseEl = document.getElementById('result-dose');
            const dailyEl = document.getElementById('result-daily');
            const hintEl = document.getElementById('age-hint');
            const freqEl = document.getElementById('freq-text-display');
            const resultBox = document.getElementById('result-box');

            if (!peso || peso <= 0) {
                doseEl.innerText = "---";
                dailyEl.innerText = "---";
                if(hintEl) hintEl.innerText = "";
                return;
            }

            if (med.tipoCalculo === "tabelaDecongexGotas") {
                let doseStr = "";
                let totalStr = "";
                let idadeStr = "";
                let freqStr = "";
                
                if (peso < 10) { // Estimativa para crian√ßas menores de 2 anos
                    doseStr = "N/A";
                    totalStr = "N/A";
                    idadeStr = "Contraindicado < 2 anos";
                    freqStr = "Consulte um m√©dico.";
                    resultBox.classList.replace('bg-indigo-600', 'bg-red-500');
                } else {
                    // Di√°ria Total: 2 gotas por kg. M√°ximo: 60 gotas.
                    let totalDiario = Math.min(peso * 2, p.maxDoseDiariaGotas);
                    let dosePorTomada = Math.round(totalDiario / 3);
                    
                    doseStr = `${dosePorTomada} Gotas`;
                    totalStr = `${totalDiario} Gotas`;
                    idadeStr = `C√°lculo: 2 gotas/kg/dia (Dividido em 3x).`;
                    freqStr = "3 vezes ao dia (a cada 8 horas).";
                    resultBox.classList.replace('bg-red-500', 'bg-indigo-600');
                    if (totalDiario >= 60) resultBox.classList.replace('bg-indigo-600', 'bg-orange-500');
                }
                doseEl.innerText = doseStr;
                dailyEl.innerText = totalStr;
                hintEl.innerText = idadeStr;
                freqEl.innerText = freqStr;
            }
            else if (med.tipoCalculo === "tabelaDecongex") {
                let doseStr = "";
                let totalStr = "";
                let idadeStr = "";
                let freqStr = "";
                
                if (peso < 12) {
                    doseStr = "N/A";
                    totalStr = "N/A";
                    idadeStr = "Contraindicado < 2 anos";
                    freqStr = "Consulte um m√©dico.";
                    resultBox.classList.replace('bg-indigo-600', 'bg-red-500');
                } else if (peso >= 12 && peso < 35) {
                    doseStr = "2,5 a 5,0 mL";
                    totalStr = "10 a 20 mL";
                    idadeStr = "Crian√ßas (> 2 anos): 1/4 a 1/2 copo.";
                    freqStr = "4 vezes ao dia (a cada 6 horas).";
                    resultBox.classList.replace('bg-red-500', 'bg-indigo-600');
                } else {
                    doseStr = "10 a 15 mL";
                    totalStr = "30 a 60 mL";
                    idadeStr = "Adultos e Adolescentes: 1 a 1,5 copo.";
                    freqStr = "3 a 4 vezes ao dia.";
                    resultBox.classList.replace('bg-red-500', 'bg-indigo-600');
                }
                doseEl.innerText = doseStr;
                dailyEl.innerText = totalStr;
                hintEl.innerText = idadeStr;
                freqEl.innerText = freqStr;
            }
            else if (med.nome.includes("Solu√ß√£o 3 mg/mL")) {
                let mgKg = p.currentIntensidade;
                let doseMgTotal = peso * mgKg;
                let limitada = false;
                if (doseMgTotal > p.maxDoseDiariaMg) { doseMgTotal = p.maxDoseDiariaMg; limitada = true; }
                let mlTotal = (doseMgTotal / 3).toFixed(1);
                doseEl.innerText = `${mlTotal} mL`;
                dailyEl.innerText = `20.0 mL`;
                hintEl.innerText = `C√°lculo: ${mgKg} mg/kg (${doseMgTotal.toFixed(1)} mg totais).`;
                if (limitada) resultBox.classList.replace('bg-indigo-600', 'bg-orange-500');
                else resultBox.classList.replace('bg-orange-500', 'bg-indigo-600');
            }
            else if (med.nome.includes("Gotas") && med.nome.includes("Predsim")) {
                let mgKg = p.currentIntensidade;
                let doseMg = peso * mgKg;
                let gotas = Math.round(doseMg / 0.55);
                let limitada = false;
                if (gotas > p.maxDoseDiaria) { gotas = p.maxDoseDiaria; limitada = true; }
                doseEl.innerText = `${gotas} Gotas`;
                dailyEl.innerText = `145 Gotas`; 
                hintEl.innerText = `C√°lculo: ${mgKg} mg/kg (${doseMg.toFixed(1)} mg totais).`;
                if (limitada) resultBox.classList.replace('bg-indigo-600', 'bg-orange-500');
                else resultBox.classList.replace('bg-orange-500', 'bg-indigo-600');
            }
            else if (med.tipoCalculo === "tabelaBuscopanComposto") {
                let gotasPorDose = Math.round(peso * 0.5); 
                doseEl.innerText = `${gotasPorDose} Gotas`;
                dailyEl.innerText = `${gotasPorDose * 3} Gotas`;
                hintEl.innerText = `Crian√ßa (Ref: 1 gota/2kg)`;
            }
            else if (med.tipoCalculo === "tabelaBuscopan") {
                let gotasPorDose = Math.round(peso);
                doseEl.innerText = `${gotasPorDose} Gotas`;
                dailyEl.innerText = `${gotasPorDose * 3} Gotas`;
                hintEl.innerText = `Crian√ßa (Ref: 1 gota/kg)`;
            }
            else if (med.tipoCalculo === "tabelaDipirona") {
                let gotasPorDose = Math.round(peso);
                doseEl.innerText = `${gotasPorDose} Gotas`;
                dailyEl.innerText = `${gotasPorDose * 4} Gotas`;
                hintEl.innerText = `Crian√ßa (Tabela oficial)`;
            }
            else if (med.tipoCalculo === "intensidade") {
                let mgKg = p.currentIntensidade;
                let doseMg = (peso * mgKg);
                let gotas = Math.round((doseMg / p.concentracaoMgPerMl) * 20);
                doseEl.innerText = `${gotas} Gotas`;
                dailyEl.innerText = `${gotas * 4} Gotas`;
            }
        };

        window.changeIntensity = (medId, valor) => {
            const med = window.allMedicamentos.find(m => m.id === medId);
            med.pesoBaseCalculo.currentIntensidade = valor;
            setupCalculator(med);
            const pesoInput = document.getElementById('peso-input');
            if(window.lastWeight) pesoInput.value = window.lastWeight;
            runCalculation(medId);
        };

        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</head>
<body class="min-h-screen pb-10">
    <div id="loading-overlay" class="fixed inset-0 bg-white z-40 flex flex-col items-center justify-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-indigo-500"></div>
    </div>

    <div class="max-w-4xl mx-auto p-4 md:p-8">
        <header class="mb-6 text-center">
            <div class="logo-container">
                <img src="souza_farma_logo.png" alt="Souza Farma" class="w-full h-auto" onerror="this.src='https://placehold.co/300x100?text=Souza+Farma'">
            </div>
            <h1 class="text-2xl font-bold text-indigo-700 mt-4 tracking-tight">Souza Farma - Bulas</h1>
        </header>

        <div class="mb-6 bg-white p-4 rounded-2xl shadow-lg border border-indigo-50">
            <input type="text" placeholder="üîç Buscar medicamento ou princ√≠pio ativo..." oninput="searchMedicamentos(this.value)" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
        </div>

        <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>

    <div id="bula-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-80 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-6 md:p-8 w-full max-w-2xl max-h-[95vh] overflow-y-auto relative shadow-2xl border border-white">
            <button onclick="closeModal('bula-modal')" class="close-button absolute top-4 right-6 text-4xl text-gray-400 hover:text-gray-600 transition-colors">&times;</button>
            <div id="bula-content"></div>
        </div>
    </div>
</body>
</html>
